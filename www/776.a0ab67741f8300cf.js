"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[776],{776:(V,k,a)=>{a.r(k),a.d(k,{RoutesPageModule:()=>L});var b=a(177),j=a(9417),c=a(9893),y=a(9315),g=a(467),m=a(8199),e=a(4438),F=a(7291),S=a(8176),x=a(4796),I=a(7990),M=a(8359),$=a(6619);const E=["map"],U=["summaryPanel"];let G=(()=>{class n{constructor(t,i,s,o,r,h){this.maps=t,this.renderer=i,this.auth=s,this.shipmentService=o,this.toasterService=r,this.storageService=h,this.hasRoutes=new e.bkB,this.subscriptions=new M.yU,this.source={lat:17.528643827645652,lng:-88.18402155629833},this.shipments=[],this.summary="",this.poo=!1,this.hasDeliveryRoutes=!1,this.driverRoutes=[]}ngOnChanges(t){var i=this;t.refreshDriverRoute&&this.subscriptions.add(this.auth.userData$.subscribe(function(){var s=(0,g.A)(function*(o){i.authUser=o?.apiKey?o:yield i.storageService.get(m.u.AUTH),i.authUser?.apiKey&&i.loadDriverRoute()});return function(o){return s.apply(this,arguments)}}()))}ngOnInit(){var t=this;this.subscriptions.add(this.auth.userData$.subscribe(function(){var i=(0,g.A)(function*(s){t.authUser=s?.apiKey?s:yield t.storageService.get(m.u.AUTH),t.authUser?.apiKey&&t.loadDriverRoute()});return function(s){return i.apply(this,arguments)}}()))}ngOnDestroy(){this.subscriptions.unsubscribe()}ngAfterViewInit(){var t=this;return(0,g.A)(function*(){t.googleMaps=yield t.maps.loadGoogleMaps(),t.initializeMap()})()}initializeMap(){var t=this;return(0,g.A)(function*(){const i=t.mapElementRef.nativeElement;t.map=new t.googleMaps.Map(i,{center:t.source,disableDefaultUI:!0,zoom:12}),t.directionsService=new t.googleMaps.DirectionsService,t.directionsDisplay=new t.googleMaps.DirectionsRenderer({map:t.map,polylineOptions:{strokeWeight:3,strokeOpacity:1,strokeColor:"#028fa5"},suppressMarkers:!0}),t.renderer.addClass(i,"visible")})()}loadDriverRoute(){this.subscriptions.add(this.shipmentService.getDriverRoute(this.authUser.apiKey).subscribe({next:t=>{const i=!(!t?.origin||!t?.destination);if(this.hasDeliveryRoutes=i,this.hasRoutes.emit(i),!i)return void this.clearRoute();this.shipments=t,this.poo=!!t.poo;const s=t.origin?.address,o=t.destination?.address,r=t.waypoints?.map(h=>({location:h.address,stopover:!0}))??[];s&&o&&this.calculateAndDisplayRoute(s,o,r,t.shipments,this.poo,this.map)},error:t=>{let i="Network Issue. ";i+=t.error?.message??t.message,this.hasDeliveryRoutes=!1,this.hasRoutes.emit(!1),this.clearRoute(),this.toasterService.presentToast(i,"danger",6e3)}}))}renderMarker(t,i,s){var o=this;return(0,g.A)(function*(r,h,_,v=!0,D=!1){const R=o.googleMaps,d=v?r.end_location:r.start_location,l={url:"../../../assets/images/"+(D?"origin-marker.png":"destination-icon.png"),scaledSize:new R.Size(30,40),origin:new R.Point(0,0),anchor:new R.Point(22,18)},p=new R.Marker({position:d,map:_,icon:l,animation:R.Animation.DROP,title:v?r.end_address:r.start_address}),w=new R.InfoWindow({content:h});p.addListener("click",()=>w.open(_,p))}).apply(this,arguments)}calculateAndDisplayRoute(t,i,s,o,r,h){this.directionsService.route({origin:t,destination:i,waypoints:s,optimizeWaypoints:!0,travelMode:this.googleMaps.TravelMode.DRIVING},(v,D)=>{if("OK"===D){this.directionsDisplay.setDirections(v);const d=v.routes[0].legs;this.driverRoutes=[],d&&(this.source={lat:d[0].start_location.lat(),lng:d[0].start_location.lng()});for(let u=0;u<d.length;u++){const l=d[u],p=o[u],w=`\n              <b>Route Segment ${u+1}</b><br>\n              <b>Distance:</b> ${l.distance.text}<br>\n              ${l.start_address} to ${l.end_address}<br>\n              <b>Shipment Number:</b> ${p?.number}<br>\n              ${p?.info?Object.values(p.info).join("<br>"):""}\n            `;this.renderMarker(l,w,h),l.number=p?.number,l.id=p?.id,l.info=p?.info,this.driverRoutes.push(l),0===u&&(this.summary=`<section class="border-bottom mb-4 pb-4">${w}</section>`)}if(r&&d[0]){const u=d[0];this.renderMarker(u,`\n              <b>Point of Origin:</b><br>\n              <b>Distance:</b> ${u.distance.text}<br>\n              ${u.start_address} to ${u.end_address}\n            `,h,!1,!0)}this.shipmentService.routeSet(m.u.DRIVER_DWAYPOINTS,this.driverRoutes)}else window.alert("Directions request failed due to "+D)})}clearRoute(){this.directionsDisplay&&this.directionsDisplay.set("directions",null),this.driverRoutes=[],this.summary="",this.shipments=[]}static{this.\u0275fac=function(i){return new(i||n)(e.rXU($.d),e.rXU(e.sFG),e.rXU(x.u),e.rXU(S.o),e.rXU(I.W),e.rXU(F.n))}}static{this.\u0275cmp=e.VBU({type:n,selectors:[["app-map"]],viewQuery:function(i,s){if(1&i&&(e.GBs(E,7),e.GBs(U,5)),2&i){let o;e.mGM(o=e.lsd())&&(s.mapElementRef=o.first),e.mGM(o=e.lsd())&&(s.summaryPanelRef=o.first)}},inputs:{refreshDriverRoute:"refreshDriverRoute"},outputs:{hasRoutes:"hasRoutes"},standalone:!0,features:[e.OA$,e.aNF],decls:4,vars:1,consts:[["map",""],[1,"map"],["id","directions-panel"]],template:function(i,s){1&i&&(e.nrm(0,"div",1,0),e.j41(2,"div",2),e.EFF(3),e.k0s()),2&i&&(e.R7$(3),e.JRh(s.summary))},styles:[".map[_ngcontent-%COMP%]{position:absolute;height:100%;width:100%;background-color:transparent;opacity:0;transition:opacity .15s ease-in}.map.visible[_ngcontent-%COMP%]{opacity:1}"]})}}return n})();function T(n,f){1&n&&(e.j41(0,"ion-grid",16)(1,"ion-row",17)(2,"ion-col",18)(3,"ion-grid",17)(4,"ion-row",19)(5,"ion-col",20),e.nrm(6,"img",21),e.k0s(),e.j41(7,"ion-col",20)(8,"h3",22),e.EFF(9,"No available routes to show."),e.k0s()()()()()()())}function C(n,f){if(1&n){const t=e.RV6();e.j41(0,"section",8)(1,"ion-refresher",9),e.bIt("ionRefresh",function(s){e.eBV(t);const o=e.XpG();return e.Njj(o.loadData(s))}),e.nrm(2,"ion-refresher-content"),e.k0s(),e.j41(3,"ion-grid")(4,"ion-row")(5,"ion-col",10)(6,"ion-button",11),e.EFF(7,"Delivery Route"),e.k0s()(),e.j41(8,"ion-col",10)(9,"ion-button",12),e.EFF(10,"Pickup Route"),e.k0s()()()(),e.DNE(11,T,10,0,"ion-grid",13),e.j41(12,"section",14)(13,"app-map",15),e.bIt("hasRoutes",function(s){e.eBV(t);const o=e.XpG();return e.Njj(o.onHasRoutesChanged(s))}),e.k0s()()()}if(2&n){const t=e.XpG();e.R7$(11),e.Y8G("ngIf",!t.hasDriverRoute),e.R7$(),e.Y8G("hidden",!t.hasDriverRoute),e.R7$(),e.Y8G("refreshDriverRoute",t.refreshDriverRouteCounter)}}function N(n,f){if(1&n&&(e.j41(0,"p",40),e.EFF(1),e.k0s()),2&n){const t=f.$implicit;e.R7$(),e.JRh(t.value)}}function P(n,f){if(1&n&&(e.j41(0,"ion-row",31)(1,"ion-col",32)(2,"p",33),e.EFF(3,"ORIGIN"),e.k0s(),e.j41(4,"p",34),e.EFF(5),e.k0s()(),e.j41(6,"ion-col",32)(7,"p",33),e.EFF(8,"DESTINATION"),e.k0s(),e.j41(9,"p",34),e.EFF(10),e.k0s()(),e.j41(11,"ion-col",35)(12,"p",27),e.EFF(13,"Additional Details"),e.k0s(),e.DNE(14,N,2,1,"p",36),e.nI1(15,"keyvalue"),e.k0s(),e.j41(16,"ion-col",37)(17,"ion-grid")(18,"ion-row",38)(19,"ion-col",39)(20,"p",27),e.EFF(21,"DISTANCE"),e.k0s(),e.j41(22,"h5",40),e.EFF(23),e.k0s()(),e.j41(24,"ion-col",41)(25,"p",27),e.EFF(26,"DURATION"),e.k0s(),e.j41(27,"h5",40),e.EFF(28),e.k0s()()()()()()),2&n){const t=e.XpG().$implicit;e.R7$(5),e.JRh(t.start_address),e.R7$(5),e.JRh(t.end_address),e.R7$(4),e.Y8G("ngForOf",e.bMT(15,5,t.info)),e.R7$(9),e.JRh(t.distance.text),e.R7$(5),e.JRh(t.duration.text)}}function O(n,f){if(1&n){const t=e.RV6();e.j41(0,"ion-grid",24)(1,"ion-row",25),e.bIt("click",function(){const s=e.eBV(t).$implicit,o=e.XpG(2);return e.Njj(o.hideSegment(s.index))}),e.j41(2,"ion-col",26)(3,"h5",27),e.EFF(4),e.k0s(),e.j41(5,"h5",22),e.EFF(6),e.k0s()(),e.j41(7,"ion-col",28)(8,"ion-button",29),e.bIt("click",function(){const s=e.eBV(t).$implicit,o=e.XpG(2);return e.Njj(o.viewDetails(s.id))}),e.EFF(9,"SIGN"),e.k0s()()(),e.DNE(10,P,29,7,"ion-row",30),e.k0s()}if(2&n){const t=f.$implicit,i=e.XpG(2);e.R7$(4),e.SpI("Route Segment ",t.index,""),e.R7$(2),e.JRh(t.number),e.R7$(4),e.Y8G("ngIf",t.index==i.segment)}}function A(n,f){if(1&n&&(e.j41(0,"section",8),e.DNE(1,O,11,3,"ion-grid",23),e.k0s()),2&n){const t=e.XpG();e.R7$(),e.Y8G("ngForOf",t.routes)}}const X=[{path:"",component:(()=>{class n{constructor(t,i,s,o,r,h){this.storageService=t,this.shipmentService=i,this.auth=s,this.router=o,this.toasterService=r,this.loadingController=h,this.routes=[],this.search="",this.hasDriverRoute=!1,this.segment=1,this.segmentIcon="caret-down-circle-outline",this.refreshDriverRouteCounter=0,this.searchingFlag=!1,this.errorMessage=!1}ngOnInit(){}ionViewDidEnter(){console.log("delivery route"),this.loadRoutes(),this.refreshDriverRouteCounter++}loadRoutes(){var t=this;return(0,g.A)(function*(){yield t.presentLoading(),t.auth.userData$.subscribe(function(){var i=(0,g.A)(function*(s){t.authUser=s?.apiKey?s:yield t.storageService.get(m.u.AUTH),t.authUser?.apiKey&&t.shipmentService.getDriverRoute(t.authUser.apiKey).subscribe({next:o=>{"success"===o?.status?(t.shipments_route=o,t.storageService.set(m.u.DRIVER_DELIVER_ROUTE,o),t.shipmentService.routeGetObservable(m.u.DRIVER_DWAYPOINTS).subscribe(r=>{r&&t.get_delivery_waypoints()})):t.toasterService.presentToast(o.message||"Unknown error","danger",2e3),t.loadingController.dismiss()},error:o=>{t.toasterService.presentToast("Network Issue. "+(o.error?.message||o.message||""),"danger",2e3),t.loadingController.dismiss()}})});return function(s){return i.apply(this,arguments)}}())})()}get_delivery_waypoints(){const t=this.shipmentService.routeGet(m.u.DRIVER_DWAYPOINTS);this.routes=t?this.remapData(t):[]}remapData(t){return t.map((i,s)=>({...i,index:s+1}))}presentLoading(){var t=this;return(0,g.A)(function*(){yield(yield t.loadingController.create({spinner:"bubbles",message:"Loading routes...",duration:3e3})).present()})()}onSearchShipment(){this.searchShipments()}onInput(){this.onClear()}onClear(){this.searchedList=null,this.searchingFlag=!1,this.errorMessage=!1}resetSearch(){this.searchedList=null,this.errorMessage=!1,this.search=""}searchShipments(){this.presentLoading(),this.searchingFlag=!0;const t=this.search.trim();this.shipmentService.searchShipment(this.authUser.apiKey,t).subscribe({next:i=>{this.errorMessage=i?"":"No result Found",this.searchedList=i.data,this.searchingFlag=!1,this.setDate(),this.loadingController.dismiss()},error:i=>{this.errorMessage="Network Issue. "+(i.error?.message||""),this.toasterService.presentToast(this.errorMessage,"danger",2e3),this.loadingController.dismiss()}})}setDate(){this.searchedList.forEach((t,i)=>{t.shipment_history?.length&&(this.searchedList[i].current_date=t.shipment_history[0].date)})}trackDetails(t){this.router.navigate(["./home/view/"+t])}hideSegment(t){this.segment=t}viewDetails(t){this.router.navigate(["./home/shipment/"+t])}loadData(t){}onHasRoutesChanged(t){this.hasDriverRoute=t,console.log(this.hasDriverRoute)}static{this.\u0275fac=function(i){return new(i||n)(e.rXU(F.n),e.rXU(S.o),e.rXU(x.u),e.rXU(y.Ix),e.rXU(I.W),e.rXU(c.Xi))}}static{this.\u0275cmp=e.VBU({type:n,selectors:[["app-routes"]],decls:10,vars:3,consts:[["id","dark_backgrounded",1,"ion-no-border",3,"translucent"],["color","clear"],["slot","secondary",2,"width","100%"],["color","primary"],["id","app-logo","src","../../assets/images/logo.png","alt","Site Logo","height","35px",1,"inner-page"],[1,"ion-padding"],["id","content-inner"],["class","main-page",4,"ngIf"],[1,"main-page"],["slot","fixed",3,"ionRefresh"],["size","6",1,"ion-text-center"],["expand","full","size","small","color","primary","routerLink","/home/routes",1,"wpc-button-sm-green","ion-text-uppercase"],["expand","full","size","small","color","secondary","routerLink","/home/pick-up-route",1,"wpc-button-sm-blue","ion-text-uppercase"],["class","grid-with-background shadowed ion-no-padding",4,"ngIf"],[1,"map",3,"hidden"],[3,"hasRoutes","refreshDriverRoute"],[1,"grid-with-background","shadowed","ion-no-padding"],[1,"ion-no-padding"],["size","12",1,"ion-no-padding","ion-align-items-center"],[1,"row-with-background","ion-align-items-center","ion-justify-content-center","ion-padding"],["size","12",1,"ion-text-center"],["src","../../../assets/images/tracking.png","alt","Item icon",1,"home"],[1,"white","ion-text-uppercase"],["class","grid-with-background ion-no-padding",4,"ngFor","ngForOf"],[1,"grid-with-background","ion-no-padding"],[1,"row-with-background","ion-align-items-center",3,"click"],["size","8"],[1,"text-label-small","ion-text-uppercase"],["size","4",1,"ion-text-center"],["color","primary","expand","full","size","small",1,"wpc-button-sm-red","ion-text-uppercase",3,"click"],["class","ion-align-items-center padded-row",4,"ngIf"],[1,"ion-align-items-center","padded-row"],["size","12"],[1,"text-label-small"],[1,"text-large","ion-padding-start"],["size"," 12",1,"ion-padding"],["class","text-large ion-text-uppercase",4,"ngFor","ngForOf"],["size","12",1,"padded-row"],[1,"row-with-background","ion-align-items-center"],["size","6"],[1,"text-large","ion-text-uppercase"],["size","6",1,"ion-text-right"]],template:function(i,s){1&i&&(e.j41(0,"ion-header",0)(1,"ion-toolbar",1)(2,"ion-buttons",2),e.nrm(3,"ion-menu-button",3),e.j41(4,"ion-title",3),e.nrm(5,"img",4),e.k0s()()()(),e.j41(6,"ion-content",5)(7,"div",6),e.DNE(8,C,14,3,"section",7)(9,A,2,1,"section",7),e.k0s()()),2&i&&(e.Y8G("translucent",!0),e.R7$(8),e.Y8G("ngIf",!s.searchedList),e.R7$(),e.Y8G("ngIf",!s.searchedList&&s.hasDriverRoute))},dependencies:[b.Sq,b.bT,c.Jm,c.QW,c.hU,c.W9,c.lO,c.eU,c.MC,c.To,c.Ki,c.ln,c.BC,c.ai,c.N7,y.Wk,G,b.lG]})}}return n})()}];let z=(()=>{class n{static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275mod=e.$C({type:n})}static{this.\u0275inj=e.G2t({imports:[y.iI.forChild(X),y.iI]})}}return n})(),L=(()=>{class n{static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275mod=e.$C({type:n})}static{this.\u0275inj=e.G2t({imports:[b.MD,j.YN,c.bv,z]})}}return n})()}}]);