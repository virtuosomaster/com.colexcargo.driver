"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8922],{8922:(M,f,n)=>{n.r(f),n.d(f,{ShipmentsPageModule:()=>w});var g=n(177),E=n(9417),o=n(9893),m=n(9315),S=n(467),p=n(8199),I=n(7468),d=n(7673),u=n(6697),k=n(5558),F=n(9437),t=n(4438),R=n(7291),b=n(8176),y=n(4796),$=n(7990);function _(i,c){1&i&&(t.j41(0,"div",15)(1,"ion-text",16),t.nrm(2,"ion-spinner",17),t.EFF(3," Searching Shipment... "),t.k0s()())}function j(i,c){if(1&i&&(t.j41(0,"div",18)(1,"ion-text"),t.nrm(2,"ion-icon",19),t.EFF(3),t.k0s()()),2&i){const e=t.XpG();t.R7$(3),t.SpI(" ",e.errorMessage," ")}}function D(i,c){if(1&i&&(t.j41(0,"span",46),t.EFF(1),t.k0s()),2&i){const e=t.XpG().$implicit;t.R7$(),t.SpI("",e["wpc-pm-weight"]," Kg | ")}}function T(i,c){if(1&i&&(t.j41(0,"span",46),t.EFF(1),t.k0s()),2&i){const e=t.XpG().$implicit;t.R7$(),t.SpI("",e["wpc-pm-length"]," cm | ")}}function G(i,c){if(1&i&&(t.j41(0,"span",46),t.EFF(1),t.k0s()),2&i){const e=t.XpG().$implicit;t.R7$(),t.SpI("",e["wpc-pm-height"]," cm | ")}}function P(i,c){if(1&i&&(t.j41(0,"span",46),t.EFF(1),t.k0s()),2&i){const e=t.XpG().$implicit;t.R7$(),t.SpI("",e["wpc-pm-height"]," cm")}}function x(i,c){if(1&i&&(t.j41(0,"p",44),t.DNE(1,D,2,1,"span",45)(2,T,2,1,"span",45)(3,G,2,1,"span",45)(4,P,2,1,"span",45),t.k0s()),2&i){const e=c.$implicit;t.R7$(),t.Y8G("ngIf",e["wpc-pm-weight"]),t.R7$(),t.Y8G("ngIf",e["wpc-pm-length"]),t.R7$(),t.Y8G("ngIf",e["wpc-pm-height"]),t.R7$(),t.Y8G("ngIf",e["wpc-pm-height"])}}function U(i,c){if(1&i){const e=t.RV6();t.j41(0,"section",21)(1,"div",22)(2,"div",23)(3,"div",24)(4,"h5",10),t.EFF(5),t.k0s(),t.j41(6,"div",25)(7,"p",26),t.bIt("click",function(){const a=t.eBV(e).$implicit,r=t.XpG(2);return t.Njj(r.viewDetails(a.ID))}),t.EFF(8,"SIGN"),t.k0s(),t.j41(9,"p",26),t.bIt("click",function(){const a=t.eBV(e).$implicit,r=t.XpG(2);return t.Njj(r.trackDetails(a.ID))}),t.EFF(10,"VIEW"),t.k0s()()(),t.DNE(11,x,5,4,"p",27),t.j41(12,"p",28),t.EFF(13),t.k0s(),t.j41(14,"p",28),t.EFF(15),t.k0s()()(),t.j41(16,"div",29),t.nrm(17,"ion-icon",30),t.j41(18,"div",31)(19,"div",32)(20,"div",33)(21,"div",34)(22,"p",35),t.EFF(23,"COLEX"),t.k0s()(),t.nrm(24,"div",36),t.k0s(),t.j41(25,"div",37),t.nrm(26,"div",38)(27,"div",39),t.k0s()()(),t.nrm(28,"hr",40)(29,"ion-icon",41),t.k0s(),t.j41(30,"div",42)(31,"h5",43),t.EFF(32),t.k0s()()()}if(2&i){const e=c.$implicit;t.R7$(5),t.JRh(e.post_title),t.R7$(6),t.Y8G("ngForOf",e.shipment_packages),t.R7$(2),t.SpI("From: ",e.wpcargo_shipper_address,""),t.R7$(2),t.SpI("To: ",e.wpcargo_receiver_address,""),t.R7$(17),t.JRh(e.status)}}function X(i,c){if(1&i&&(t.j41(0,"div"),t.DNE(1,U,33,5,"section",20),t.k0s()),2&i){const e=t.XpG();t.R7$(),t.Y8G("ngForOf",e.shipments)}}const L=[{path:"",component:(()=>{class i{constructor(e,s,a,r,l,h,v,N){this.activatedRoute=e,this.storageService=s,this.shipmentService=a,this.auth=r,this.router=l,this.toasterService=h,this.loadingController=v,this._location=N,this.status="",this.shipments=[],this.currentDate=new Date,this.page=1,this.search="",this.searchedList=null,this.shipment_charge=0,this.stateFlag=!1,this.loadFlag=!1,this.searchingFlag=!1,this.noResultFlag=!1,this.isSettingsSetup=!1,this.errorMessage="",this.subscriptions=[]}ngOnInit(){const e=this.activatedRoute.paramMap.pipe((0,u.s)(1)).subscribe(s=>{this.status=s.get("status")??"",this.loadShipmentsData()});this.subscriptions.push(e)}ngOnDestroy(){this.subscriptions.forEach(e=>e.unsubscribe())}ionViewWillEnter(){var e=this;return(0,S.A)(function*(){const s=yield e.presentLoading();e.loadShipmentsData().catch(a=>{e.handleError(a,"Failed to load shipments on view enter")}).finally(()=>{s.dismiss()})})()}presentLoading(){var e=this;return(0,S.A)(function*(){const s=yield e.loadingController.create({spinner:"circles",message:"Loading shipments...",duration:6e3});return yield s.present(),s})()}loadShipmentsData(){return new Promise((e,s)=>{this.storageService.get(p.u.STATUS).then(r=>{this.isSettingsSetup=!0}).catch(()=>{this.isSettingsSetup=!1});const a=this.auth.userData$.pipe((0,u.s)(1),(0,k.n)(r=>r?.apiKey?(this.authUser=r,(0,I.p)({shipments:this.shipmentService.pageByStatus(r.apiKey,this.page,this.status).pipe((0,F.W)(l=>(this.handleError(l,"Failed to fetch shipments"),(0,d.of)([])))),podSettings:this.shipmentService.getPODSettings(r.apiKey).pipe((0,F.W)(l=>(this.handleError(l,"Failed to fetch POD settings"),(0,d.of)(null))))})):(0,d.of)({shipments:[],podSettings:null}))).subscribe({next:({shipments:r,podSettings:l})=>{if(this.shipments=r,this.searchingFlag=!1,l){const h=l,v=h.unrequired??[];this.page=1,this.storageService.set(p.u.STATUS,h.status),this.storageService.set(p.u.DELIVER_ROUTE,h.route.delivered),this.storageService.set(p.u.CANCELLED_ROUTE,h.route.cancelled),this.storageService.set(p.u.SHIPPER_FIELDS,h.fields.shipper),this.storageService.set(p.u.RECEIVER_FIELDS,h.fields.receiver),this.storageService.set(p.u.UNREQUIRED_FIELDS,v),this.storageService.set(p.u.SIGN_FIELDS,h.sign_fields)}e()},error:r=>{this.handleError(r,"Failed to load shipment data"),s(r)}});this.subscriptions.push(a)})}setShipments(){const e=this.shipmentService.userShipments$.pipe((0,u.s)(1)).subscribe(s=>{s?.length&&(this.shipments=s)});this.subscriptions.push(e)}viewDetails(e){this.router.navigate(["./home/shipment/"+e])}trackDetails(e){this.router.navigate(["./home/view/"+e])}onSearchShipment(){this.searchShipments()}onInput(){this.onClear()}onClear(){this.searchedList=null,this.searchingFlag=!1,this.errorMessage=""}resetSearch(){this.searchedList=null,this.search=""}searchShipments(){this.search.trim()&&(this.searchingFlag=!0,this.shipmentService.getRoute(this.authUser.apiKey,"/shipment/search/"+this.search.trim()).subscribe({next:e=>{const s=!e||Array.isArray(e)&&0===e.length;this.errorMessage=s?"No result Found":"",this.searchedList=e||[],this.searchingFlag=!1},error:e=>{this.handleError(e,"Failed to search shipments"),this.searchingFlag=!1}}))}loadData(e){this.page++,this.shipmentService.pageByStatus(this.authUser.apiKey,this.page,this.status).subscribe({next:s=>{s&&0!==s.length?this.shipments.push(...s):e.target.disabled=!0,e.target.complete()},error:s=>{this.handleError(s,"Failed to load more shipments"),e.target.complete()}})}goToShipments(){this.router.navigate(["./home/dashboard/"])}handleError(e,s="Network Issue"){this.toasterService.presentToast(`${s}: ${e.message||"Unknown error"}`,"danger",6e3)}static{this.\u0275fac=function(s){return new(s||i)(t.rXU(m.nX),t.rXU(R.n),t.rXU(b.o),t.rXU(y.u),t.rXU(m.Ix),t.rXU($.W),t.rXU(o.Xi),t.rXU(g.aZ))}}static{this.\u0275cmp=t.VBU({type:i,selectors:[["app-shipments"]],decls:18,vars:5,consts:[["id","dark_backgrounded",1,"ion-no-border",3,"translucent"],["color","clear"],["slot","secondary",2,"width","100%"],["color","primary"],["id","app-logo","src","../../assets/images/logo.png","alt","Site Logo","height","35px",1,"inner-page"],[3,"click"],["name","arrow-undo-circle-outline","color","primary"],[1,"ion-margin","ion-padding"],["id","content-inner"],[1,"greetings"],[1,"dark-blue","ion-text-start","title","ion-margin"],["name","cube-outline","color","warning"],["class","ion-text-center ion-margin-vertical",4,"ngIf"],["class","error-message ion-text-center ion-margin-bottom",4,"ngIf"],[4,"ngIf"],[1,"ion-text-center","ion-margin-vertical"],["color","secondary"],["color","secondary","name","bubbles",1,"icon-vcenter"],[1,"error-message","ion-text-center","ion-margin-bottom"],["name","alert",1,"icon-vcenter"],["class","inner-list","lines","full",4,"ngFor","ngForOf"],["lines","full",1,"inner-list"],[1,"details","content-0","greetings"],[1,"details","content-1"],[1,"mopving-truck"],[1,"buttons"],[1,"package-details",3,"click"],["class","package-details ion-padding-left ion-margin-left",4,"ngFor","ngForOf"],[1,"package-details"],[1,"tracking-record"],["name","storefront","color","primary",1,"pickup-point"],[1,"travel-inner"],[1,"car-inner"],[1,"carbody"],[1,"carbody-1"],[1,"small-text"],[1,"carbody-2"],[1,"carcycle"],[1,"carcycle-1"],[1,"carcycle-2"],[1,"road"],["name","cube","color","primary",1,"dropoff-point"],[1,"status"],[1,"dark-blue","ion-text-center","ion-text-uppercase","title","ion-margin"],[1,"package-details","ion-padding-left","ion-margin-left"],["class","label-sm-indented",4,"ngIf"],[1,"label-sm-indented"]],template:function(s,a){1&s&&(t.j41(0,"ion-header",0)(1,"ion-toolbar",1)(2,"ion-buttons",2),t.nrm(3,"ion-menu-button",3),t.j41(4,"ion-title",3),t.nrm(5,"img",4),t.k0s(),t.j41(6,"ion-button",5),t.bIt("click",function(){return a.goToShipments()}),t.nrm(7,"ion-icon",6),t.k0s()()()(),t.j41(8,"ion-content",7)(9,"div",8)(10,"div",9)(11,"ion-text",3)(12,"h1",10),t.EFF(13),t.k0s()(),t.nrm(14,"ion-icon",11),t.k0s(),t.DNE(15,_,4,0,"div",12)(16,j,4,1,"div",13)(17,X,2,1,"div",14),t.k0s()()),2&s&&(t.Y8G("translucent",!0),t.R7$(13),t.SpI("",a.status," Shipments"),t.R7$(2),t.Y8G("ngIf",a.searchingFlag),t.R7$(),t.Y8G("ngIf",a.errorMessage),t.R7$(),t.Y8G("ngIf",!a.searchingFlag&&!a.searchedList))},dependencies:[g.Sq,g.bT,o.Jm,o.QW,o.W9,o.eU,o.iq,o.MC,o.w2,o.IO,o.BC,o.ai]})}}return i})()}];let C=(()=>{class i{static{this.\u0275fac=function(s){return new(s||i)}}static{this.\u0275mod=t.$C({type:i})}static{this.\u0275inj=t.G2t({imports:[m.iI.forChild(L),m.iI]})}}return i})(),w=(()=>{class i{static{this.\u0275fac=function(s){return new(s||i)}}static{this.\u0275mod=t.$C({type:i})}static{this.\u0275inj=t.G2t({imports:[g.MD,E.YN,o.bv,C]})}}return i})()}}]);